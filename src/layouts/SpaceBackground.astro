---
const { showGradient = false } = Astro.props;
---

<style is:global>
	.cosmic-bg {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background:
			radial-gradient(
				ellipse at 20% 30%,
				rgba(88, 28, 135, 0.3) 0%,
				transparent 50%
			),
			radial-gradient(
				ellipse at 80% 70%,
				rgba(30, 58, 138, 0.3) 0%,
				transparent 50%
			),
			radial-gradient(
				ellipse at 50% 50%,
				rgba(5, 5, 5, 1) 0%,
				rgba(0, 0, 0, 1) 100%
			);
		animation: cosmicShift 20s ease-in-out infinite alternate;
	}

	html[data-theme="light"] .cosmic-bg {
		background: none;
		animation: none;
	}

	.cosmic-bg.hidden {
		display: none;
	}

	@keyframes cosmicShift {
		0% {
			filter: hue-rotate(0deg);
		}
		100% {
			filter: hue-rotate(30deg);
		}
	}

	.star {
		position: absolute;
		background: white;
		border-radius: 50%;
		box-shadow: 0 0 6px rgba(255, 255, 255, 0.8);
		animation: pulse 4s ease-in-out infinite;
	}

	@keyframes pulse {
		0%,
		100% {
			opacity: 0.5;
			transform: scale(1);
		}
		50% {
			opacity: 1;
			transform: scale(1.5);
		}
	}

	.shooting-star {
		position: absolute;
		width: 2px;
		height: 2px;
		background: white;
		border-radius: 50%;
		box-shadow: 0 0 10px 2px rgba(255, 255, 255, 0.5);
		animation: shoot 3s linear infinite;
		opacity: 0;
	}

	@keyframes shoot {
		0% {
			opacity: 0;
			transform: translateX(0) translateY(0);
		}
		10% {
			opacity: 1;
		}
		90% {
			opacity: 0.5;
		}
		100% {
			opacity: 0;
			transform: translateX(300px) translateY(300px);
		}
	}
</style>

<div
	class={`cosmic-bg bg-space-radial ${showGradient ? '' : 'hidden'}`}
	transition:persist
></div>

<div class="starfield" id="starfield" transition:persist></div>

<script>
	const starfield = document.getElementById("starfield");

	if (!starfield) {
		throw Error("Cosmic starfield missing");
	}

	// Create regular stars
	for (let i = 0; i < 100; i++) {
		const star = document.createElement("div");
		star.className = "star";

		star.style.left = Math.random() * 100 + "%";
		star.style.top = Math.random() * 100 + "%";

		const size = Math.random() * 2 + 0.5;
		star.style.width = size + "px";
		star.style.height = size + "px";

		star.style.animationDuration = Math.random() * 4 + 2 + "s";
		star.style.animationDelay = Math.random() * 4 + "s";

		starfield.appendChild(star);
	}

	// Create shooting stars
	function createShootingStar() {
		if (!starfield) {
			throw Error("Cosmic starfield missing");
		}

		const star = document.createElement("div");
		star.className = "shooting-star";

		star.style.left = Math.random() * 50 + "%";
		star.style.top = Math.random() * 50 + "%";

		starfield.appendChild(star);

		setTimeout(() => {
			star.remove();
		}, 3000);
	}

	// Create shooting stars periodically
	setInterval(createShootingStar, 2000);
	createShootingStar();

	// Update gradient visibility on navigation
	function updateGradientVisibility() {
		const cosmicBg = document.querySelector(".cosmic-bg");
		if (!cosmicBg) return;

		// Check if we're on the index page
		const isIndexPage = window.location.pathname === "/";

		if (isIndexPage) {
			cosmicBg.classList.remove("hidden");
		} else {
			cosmicBg.classList.add("hidden");
		}
	}

	// Run on initial load and after each navigation
	updateGradientVisibility();
	document.addEventListener("astro:after-swap", updateGradientVisibility);
</script>
