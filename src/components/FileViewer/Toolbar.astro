---
import FoldIcon from "../Icons/FoldIcon.astro";
import UnfoldIcon from "../Icons/UnfoldIcon.astro";
import ThemeSelect from "./ThemeSelect.astro";
---

<div
	class="w-full h-[38px] mb-3 bg-white dark:bg-neutral-950 border border-neutral-300 dark:border-neutral-700 rounded-md flex items-center px-3 justify-between"
>
	<div class="flex items-center gap-4">
		<div
			class="flex items-center gap-2 border-r border-neutral-300 dark:border-neutral-700 pr-4 mr-2"
		>
			<button
				id="expand-all-btn"
				class="p-1.5 rounded-md hover:bg-neutral-100 dark:hover:bg-neutral-800 text-neutral-600 dark:text-neutral-400 transition-colors"
				title="Expand all"
			>
				<span id="unfold-icon-wrapper">
					<UnfoldIcon />
				</span>
				<span id="fold-icon-wrapper" class="hidden">
					<FoldIcon />
				</span>
			</button>
		</div>
		<div
			id="diff-filename"
			class="text-sm font-semibold text-neutral-900 dark:text-white"
		/>
		<div
			id="language-badge"
			class="hidden px-2 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 text-[10px] font-medium text-neutral-600 dark:text-neutral-400 uppercase"
		/>
	</div>
	<ThemeSelect />
</div>

<script>
	function initToolbar() {
		const expandAllBtn = document.getElementById("expand-all-btn");
		const unfoldIconWrapper = document.getElementById("unfold-icon-wrapper");
		const foldIconWrapper = document.getElementById("fold-icon-wrapper");

		let isExpanded = false;

		function updateIcon() {
			if (isExpanded) {
				unfoldIconWrapper?.classList.add("hidden");
				foldIconWrapper?.classList.remove("hidden");
				if (expandAllBtn) expandAllBtn.title = "Fold all";
			} else {
				unfoldIconWrapper?.classList.remove("hidden");
				foldIconWrapper?.classList.add("hidden");
				if (expandAllBtn) expandAllBtn.title = "Expand all";
			}
		}

		expandAllBtn?.addEventListener("click", () => {
			isExpanded = !isExpanded;
			updateIcon();
			if (isExpanded) {
				window.dispatchEvent(new CustomEvent("expand-all-diff"));
			} else {
				window.dispatchEvent(new CustomEvent("fold-all-diff"));
			}
		});

		window.addEventListener("file-diff", () => {
			isExpanded = false;
			updateIcon();
		});
	}

	initToolbar();
	document.addEventListener("astro:page-load", initToolbar);
</script>
